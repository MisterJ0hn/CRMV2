{% extends 'base.html.twig' %}

{% block title %}{{pagina|default('agenda agendador')}}{% endblock %}

{% block body %}
<form action="{{path('panel_agendador_index')}}" method="get" id="bForm">
    <input type="hidden" name="bStatus" id="bStatus" value="{{status|default('')}}">
<section>
    
    <div class="row">
        {% set total = 0 %}
        {% for resumen in resumenes %}
       
        <div class="col-sm-6 col-md-3">
            
            <div class="info-box">
                <span class="info-box-icon bg-{{resumen[0].status.color}}"><i class="{{resumen[0].status.icon}}"></i></span>
    
                <div class="info-box-content">
                <span class="info-box-text">{{resumen[0].status.nombre}}</span>
                <span class="info-box-number">{{resumen.valor}}</span>
                {% set total= total + resumen.valor %}
                 
                
                {% if resumen[0].status.vermas %}
                    <a href="#" class="small-box-footer" onclick="javascript:buscar({{resumen[0].status.id}})">
                        Ver Más <i class="fas fa-arrow-circle-right"></i>
                    </a>
                {% endif %}
                
          
                </div>

                
                <!-- /.info-box-content -->
            </div>
      
        </div>
            

        {% endfor %}
        {% if status is null %}
        <div class="col-sm-6 col-md-3">
            <div class="info-box">
                <span class="info-box-icon bg-success"><i class="far fa-flag"></i></span>
    
                <div class="info-box-content">
                <span class="info-box-text">Asignados</span>
                <span class="info-box-number">{{total}}</span>
                </div>
                <!-- /.info-box-content -->
            </div>
        </div>
        {% endif %}
        
    </div>
    
</section>
<section>


    {{ include('/cuadrosBusquedas/busquedaTicketsEncuestas.html.twig', {'TipoFiltro':TipoFiltro}) }}
</section>
</form>
{% if sesion.getSesion.usuarioTipo.id in [3,1]  %}
<section>
    {% if total>0 %}
        
    
        {{ render(controller('App\\Controller\\AgendaController::resumenagendadores', {'agendaStatus':statuesGroup,'fechainicio':dateInicio,'fechafin':dateFin,'compania':bCompania,'filtro':bFiltro,'totalStatus':total,'tipoFecha':tipoFecha,'agendador':bAgendador})) }}
        {% endif %}
</section>
{% endif %}
<section>
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Listado</h3> 
        </div>
        <!-- /.card-header -->
        <div class="card-body table-responsive p-0" style="height: 300px;">
        
            <table class="table table-head-fixed text-nowrap table-striped table-sm">
        <thead>
            <tr>
                <th>AgendaId</th>
                <th>{{ knp_pagination_sortable(agendas, 'Compañia', 'cuenta') }} {% if agendas.isSorted('cuenta') %} <i class="fas fa-sort"></i>{% endif %}</th>
                <th>{{ knp_pagination_sortable(agendas, 'Canal', 'campania') }} {% if agendas.isSorted('campania') %} <i class="fas fa-sort"></i>{% endif %}</th>
                <th>{{ knp_pagination_sortable(agendas, 'Status', 'status') }} {% if agendas.isSorted('status') %} <i class="fas fa-sort"></i>{% endif %}</th>
                {% if status is not null %}
                    <th>{{ knp_pagination_sortable(agendas, 'Sub Status', 'subStatus') }} {% if agendas.isSorted('subStatus') %} <i class="fas fa-sort"></i>{% endif %}</th>
               
                {% endif %}
                <th>Gestionar</th>
               <th>{{ knp_pagination_sortable(agendas, 'Agendador', 'agendador.nombre') }} {% if agendas.isSorted('agendador.nombre') %} <i class="fas fa-sort"></i>{% endif %}</th>
               <th>{{ knp_pagination_sortable(agendas, 'Reunión', 'reunion') }} {% if agendas.isSorted('reunion') %} <i class="fas fa-sort"></i>{% endif %}</th>
               <th>{{ knp_pagination_sortable(agendas, 'Abogado', 'abogado.nombre') }} {% if agendas.isSorted('abogado.nombre') %} <i class="fas fa-sort"></i>{% endif %}</th>
               <th>{{ knp_pagination_sortable(agendas, 'Nombre', 'nombreCliente') }} {% if agendas.isSorted('nombreCliente') %} <i class="fas fa-sort"></i>{% endif %}</th>
               <!-- <th>{{ knp_pagination_sortable(agendas, 'Email', 'emailCliente') }} {% if agendas.isSorted('emailCliente') %} <i class="fas fa-sort"></i>{% endif %}</th>
                <th>Telefono</th>-->
                <th>{{ knp_pagination_sortable(agendas, 'Fecha Carga', 'fechaCarga') }} {% if agendas.isSorted('fechaCarga') %} <i class="fas fa-sort"></i>{% endif %}</th>
                <th>{{ knp_pagination_sortable(agendas, 'Fecha Asignado', 'fechaAsignado') }} {% if agendas.isSorted('fechaAsignado') %} <i class="fas fa-sort"></i>{% endif %}</th>
                <th>{{ knp_pagination_sortable(agendas, 'Fecha Contrato', 'fechaContrato') }} {% if agendas.isSorted('fechaContrato') %} <i class="fas fa-sort"></i>{% endif %}</th>
            </tr>
        </thead>
        <tbody>
        {% for agenda in agendas %}
            <tr>
                <td>{{ agenda.id }}</td>
                <td>{{ agenda.cuenta.nombre|default('') }}</td>
                <td>{{ agenda.campania }}</td>
                <td>{{ agenda.status }}</td>
                 {% if status is not null %}
                <td>{% for observacion in agenda.agendaObservacions %}
                    {% if observacion.subStatus is not null %}
                        
                            
                       {{ observacion.subStatus.nombre }}
                    {% endif %}
                    {% endfor %}
                    
                    </td>
                 {% endif %}
                <td align="center"><a href="{{path('panel_agendador_new',{'id':agenda.id})}}" class="btn"><i class="far fa-paper-plane"></i></a></td>
   
                <td>{{ agenda.agendador.nombre|default('') }}</td>
                <td>{{ agenda.reunion|default('') }}</td>
                <td>{{ agenda.abogado.nombre|default('') }}</td>
                <td>{{ agenda.nombreCliente }}</td>
               <!-- <td><a href="mailto:{{ agenda.emailCliente }}">{{ agenda.emailCliente }}</a></td>
                <td><a href="https://api.whatsapp.com/send?phone={{ agenda.telefonoCliente }}&text=" target="_blank">{{ agenda.telefonoCliente }}</a></td>-->
                  <td>{{ agenda.fechaCarga ? agenda.fechaCarga|date('d-m-Y H:i') : '' }}</td>
                  <td>{{ agenda.fechaAsignado ? agenda.fechaAsignado|date('d-m-Y H:i') : '' }}</td>
                  <td>{{ agenda.fechaContrato ? agenda.fechaContrato|date('d-m-Y H:i') : '' }}</td>
               <!-- <td>
                    <div class="btn-group" role="group" aria-label="Basic example">
                    <a href="{{ path('agenda_show', {'id': agenda.id}) }}" class="btn btn-primary"><i class="fas fa-eye"></i></a>
                    <a href="{{ path('panel_agendador_edit', {'id': agenda.id}) }}" class="btn btn-warning"><i class="fas fa-edit"></i></a>
                    </div>
                </td>-->
            </tr>
        {% else %}
            <tr>
                <td colspan="10">no records found</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    </div>
        <div class="card-footer clearfix">
             {# display navigation #}
        <div class="navigation">
            {{ knp_pagination_render(agendas,'@KnpPaginator/Pagination/twitter_bootstrap_v4_pagination.html.twig',{},{
            'position': 'centered',
            'rounded': true,
            }) }}
        </div>
    </div>
    </div>
</section>
<script>
    $('#bFecha').daterangepicker({
        
        "drops": "up",
        "startDate":"{{dateInicio}}",
        "endDate": "{{dateFin}}",
        "locale": {
            "format": "YYYY-MM-DD",
            "applyLabel": "Apply",
            "cancelLabel": "Cancel",
        }
    }, function(start, end, label) {
    console.log('New date range selected: ' + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD') + ' (predefined range: ' + label + ')');
    
    });
    function buscar(status){
        $("#bStatus").val(status);
        $("#bForm").submit();
    }
</script>
{% endblock %}
